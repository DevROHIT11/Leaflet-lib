<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
</head>

<style>
    html {
        margin: 15px;
        padding: 0;
        background: #01000c;
        /* background-color: black; */
        font-family: sans-serif;
    }

    .heading {
        color: white;
        text-align: center;
        font-size: 12px;
        margin-bottom: 2px;
    }

    #map {
        margin: auto;
        height: 80vh;
        width: 80vw;
        color: #ffff;
        border-radius: 10px;
        box-shadow: 2px 2px 8px 2px rgb(137, 137, 137);
    }

    .state-label {
        font-size: 11px;
        font-weight: bold;
        color: #515151;
        background: transparent;
        border: none;
        box-shadow: none;
    }

    .para {
        color: white;
        margin: auto;
        text-align: center;
    }

    .leaflet-popup-content-wrapper {
        background: #05023f;
        /* dark blue / navy */
        color: #e5e7eb;
        /* text color */
        border-radius: 12px;
    }

    .leaflet-popup-tip {
        background: #1e293b;
    }

    .info {
        padding: 6px 8px;
        font: 14px/16px Arial, Helvetica, sans-serif;
        background: rgba(49, 55, 96, 0.8);
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
        color: #aeaeae;
        border-radius: 5px;
    }

    .info h4 {
        margin: 0 0 5px;
        color: rgb(144, 66, 181);

    }

    .legend {
        line-height: 18px;
        color: #ffffff;
    }

    .legend i {
        width: 18px;
        height: 18px;
        float: left;
        margin-right: 8px;
        opacity: 0.7;
    }
</style>

<body>
    <div class="heading">
        <h1>U.S. Population Density </h1>
    </div>
    <div id="map">
    </div>
    <div class="para">
        <h2>Click State to see details</h2>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin="">
        </script>

    <script>
        var map = L.map('map', {
            center: [37.8, -96],
            zoom: 3,
            minZoom: 2,
            maxZoom: 18

        });
        var geojson;

        //    normal map
        // var map = L.map('map').setView([20.5937, 78.9629], 4);
        L.tileLayer(
            'https://server.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Base/MapServer/tile/{z}/{y}/{x}',
            {
                attribution: 'Tiles Â© Esri'
            }
        ).addTo(map);


        // now function for getting the color value
        function color(density) {
            return density >= 1000 ? "#10002b" : //if block
                density >= 700 ? "#3c096c" : // if block
                    density >= 200 ? "#7b2cbf" :
                        density >= 100 ? "#9d4edd" :
                            density >= 50 ? "#e0aaff" : "#ffd6ff" //else block
        }

        function style(feature) {
            return {
                fillColor: color(feature.properties.density), //color to fill
                color: "gray", // border color
                dashArray: 3, //dashed border (1-2 dotted)
                weight: 2, //thickness of border
                fillOpacity: 0.7
            }
        }



        function highlight(e, layer) {
            var layer = e.target;
            // console.log(e.latlng)
            layer.setStyle({
                weight: 4,
                color: "#05023f",
                dashArray: '',

            });

            layer.bringToFront();
            // info.update(layer.feature.properties);

        }

        function resetHighlight(e) {
            geojson.resetStyle(e.target);
            // info.update();
        }

        function zoomToFeature(e) {
            map.fitBounds(e.target.getBounds());
        }

        function onEachFeature(feature, layer) {
            layer.on({
                mouseover: highlight,
                mouseout: resetHighlight,
                click: zoomToFeature
            });
            var props = feature.properties;
            layer.bindPopup(`<h4>US Population Density</h4>${props ?
                '<b>' + props.name + '</b><br />' + props.density + ' people / mi<sup>2</sup>'
                : 'Hover over a state'}`)

            // for states
            layer.bindTooltip(feature.properties.name, {
                permanent: true,
                direction: "center",
                className: "state-label"
            });
        }

        async function loadata() {
            const response = await fetch("us.geojson");
            const data = await response.json();

            geojson = L.geoJSON(data, {
                style: style,
                onEachFeature: onEachFeature
            }).addTo(map)


        };
        loadata();

        // var info = L.control({ position: "bottomleft" });

        // info.onAdd = function (map) {
        //     this._div = L.DomUtil.create('div', 'info'); // create a div with a class "info"
        //     this.update();
        //     return this._div;
        // };

        // method that we will use to update the control based on feature properties passed
        // info.update = function (props) {
        //     this._div.innerHTML = '<h4>US Population Density</h4>' + (props ?
        //         '<b>' + props.name + '</b><br />' + props.density + ' people / mi<sup>2</sup>'
        //         : 'Hover over a state');
        // };

        // info.addTo(map);


        // color scale
        var legend = L.control({ position: 'bottomright' });

        legend.onAdd = function (map) {

            var div = L.DomUtil.create('div', 'info legend'),
                grades = [0, 50, 100, 200, 500, 1000],
                labels = [];

            // loop through our density intervals and generate a label with a colored square for each interval
            for (var i = 0; i < grades.length; i++) {
                div.innerHTML +=
                    '<i style="background:' + color(grades[i] + 1) + '"></i> ' +
                    (grades[i]) + (grades[i + 1] ? '&ndash;' + (grades[i + 1] - 1) + '<br>' : '+');
            }

            return div;
        };

        legend.addTo(map);

        map.setMinZoom(2);


    </script>
</body>

<script>




</script>

</html>